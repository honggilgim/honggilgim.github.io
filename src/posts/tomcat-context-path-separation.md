## 1. 개요

개발을 하다 보면 똑같은 프로젝트 구조를 가진 서로 다른 두 개의 프로젝트를 만들어야 할 일이 생긴다. 예를 들어, 현재 운영하고 있는 사이트의 영문 버전이 추가될 경우 기존 사이트와 똑같은 구조를 가진 서로 다른 구조의 사이트를 하나 제작해야 한다.

그럴 경우 톰캣의 인스턴스 자체를 구분하여 도메인을 새로 만들어 하나의 서비스를 올리는 방안 (가장 간편하다.), 컨트롤러 단에서 구분하여 영문 앞에 붙는 url을 제작하여 나누거나, intercepter 를 상속받아 제작하여 url 상의 변수 혹은 파라메터에서 받는 변수를 통해 제작하거나, 프론트 단에서 전역변수 같은 것으로 구분하는 방안 등이 있을 수 있다.

프론트 단에서 구분은, 전역 변수를 선언해주는 redux같은 라이브러리를 사용하지 못하는 환경이었기에 패스하고 스프링, 스프링 부트, jsp만을 사용해야 하는 상황이었다. 또한 도메인을 새로 만드는 방안 또한 토론 끝에 안하기로 결정됬다.

## 2. context-path 구분으로 프로젝트 구분 만들기

그래서 context-path로 구분하여 ROOT폴더를 두개 만들어 사이트를 구성하기로 결정했다. context-path 구분은 인프라에서 진행해주므로, 나는 개발 단에서 겪은 오류 및 상황들만 적겠다.

### 2-1. 절대경로 수정

서버 단에서는 따로 건드릴 작업이 없다. 서버 단으로 들어오는 요청은 tomcat에서 알아서 context-path 별로 구분해준다. 그래서 백엔드 로직은 따로 건드릴 게 없었다. 하지만, 절대경로로 되어있는 다른 모든 경로가 문제였다. 보통 페이지는 헤더 혹은 base.jsp 부분에 include를 통해 다른 경로의 페이지를 import 해서 만들어진다. 이 import는 보통 절대경로로 적혀있는데, context-path를 구분해주는 처리가 되어있지 않으면 모두 원래 홈페이지에서 받아온다. 그래서 context-path를 절대경로 앞에 적어주어야 한다. 개발 초기 과정에서 모든 경로 앞에 context-path를 붙여주었다면 좋았겠지만, 아쉽게 이 프로젝트는 그런 처리가 전혀 되어있지 않았다.

```jsp
${pageContext.request.contextPath}
```

spring에서 손쉽게 context-path를 다룰 수 있는 방안이다. jsp에 할당해주는 `${}` 안에 저 구문을 넣어주면 context-path를 받아와 소스에 할당해준다. 이 구문을 모든 상대 경로를 찾아 앞에 붙여주고, 확인해서 불러오는데 성공했다. 이 구문을 붙이면 앞에 전부 context-path가 붙어 개발의 유지보수가 편해진다.

### 2-2. CSS나 JS 부분에 붙은 절대경로는..?

저 위의 구문의 단점이다. css나 js같은 정적 파일들은 페이지를 불러올 때 따로 context-path를 당연히 못붙여준다. 그래서 기존 context-path의 정적 자원들을 불러오는 문제점이 발생했다.

이 문제는 생각보다 손쉽게 풀렸는데, 그냥 상대 경로로 호출하면 된다.

반복되는 노가다 작업 끝에 결국 context-path를 전부 붙여 환경설정에 성공했고, 이제는 영문 사이트 개발에 집중하고 있다. 처음에 노가다를 진행하며 오랜 시간이 들었지만, infra 관련 지식이 늘어나 기쁘다. 나중에 이런 일이 생겼을 때 사용할 수 있는 경험이 하나 늘어났다.

저런 작업 처리가 되어있지 않다면, 도메인을 새로 만드는 것 이외에 따로 처리 없이 루트 폴더 분리 방안은 찾지 못했다. 인스턴스 분리 등 다양한 방안을 시도했고 찾으며 infra와 공유했지만 결국 소스 수정을 전범위적으로 진행해야 했다.

## 3. 결론

**context-path는 절대 경로 참조 시 꼭 붙이자!**

