## 개발 환경

- **JDK**: 1.7 (Java 7 버전)
- **스프링**: 4.2 버전 (전자정부 프레임워크)
- **웹앱 환경**

## 1. SSLHandShake 문제

전자정부 프레임워크를 이용하여 카카오 OAuth 기술을 개발하던 도중, 카카오 OAuth 연동 과정 중 SSLHandshake Exception 문제가 생겼다. 

### 문제 원인

문제의 원인은, **JDK 1.7 버전에서 지원하는 SSL 인증서가 1.2 버전 아래**인 부분이다.

카카오에서는 SSL 인증서 1.2 미만 버전의 경우는 지원해주지 않는다. 이 버전의 인증서를 가진 시스템에서 카카오 OAuth를 호출할 경우, SSL Handshake 오류가 나와 문제가 생긴다.

- **JDK 1.7 (Java 7)**: SSL 인증서 1.1 버전 지원
- **JDK 1.8 이후**: SSL 인증서 1.2 버전 지원

시스템의 스펙이 JDK 1.7 버전이어서 생긴 문제다.

### 해결 방안

문제를 해결하기 위해서는 4가지 방안이 가능한데,

#### 1. 서버에 SSL 인증서 1.2 버전 설치 (베스트)

서버 자체적으로 SSL 인증서 1.2 버전을 설치하면 정상적으로 동작한다. 

- **리눅스 서버**: 쉽게 설치 가능
- **윈도우 서버**: 기존의 인증서와 충돌할 수 있으니 삭제 후 재설치가 필요

#### 2. 스프링 코드 단에서 서버에 설치된 SSL 인증서를 통해 API 호출

서버에 설치 후 스프링 단에서 코드를 불러오는 방식이다. 위 방식보다는 효율이 떨어지지만, 아래의 방식들보다는 side effect가 덜한 방식이다.

#### 3. 스프링 SSL 인증서 우회

스프링 서버 단에서 SSL 인증서 우회 코드를 만들어 사용한다. 이 방식으로 사용할 경우 스프링 전체적으로 SSL 인증서를 우회할 수 있지만 **가장 추천하지 않는 방식**이다. 

SSL 인증서 자체가 보안에 관련된 사안인 만큼 잘못 설치할 경우 보안 문제를 야기할 수 있다.

#### 4. JDK 업그레이드

최후의 방안으로 생각한 방법이다. 3번 방법의 경우 보안 문제를 야기할 수 있기에 패스하고, 마지막으로 **JDK를 1.8로 업그레이드**하는 방식을 생각했다.

### 해결 결과

다행히 **1번 방안**에서 해결해 서버에서 인증서를 설치해 SSL Handshake Exception을 해결하는 데 성공했다.

## 2. 웹앱 환경

이번에 개발하게 된 소셜 로그인 기능은 웹앱 환경 상에서 구동한다. 이 때, 웹앱 환경상에서 수많은 문제가 터지게 된다.

### 문제 상황

웹앱으로 앱을 구동할 경우 창의 멕시멈 사이즈를 설정하여 애플리케이션을 만든다. 이 창을 설정하는 부분 및 창을 다루는 부분은 어플 개발자가 담당하지만, 어플리케이션에 수많은 영향을 끼쳐 왠만하면 창 관련 설정은 안 건드리는 것이 낫다.

하지만, 카카오 및 네이버에서 **약관 보기 버튼**과 같은 버튼을 클릭할 경우 새 창으로 열리도록 프로그래밍 되어 있다. 이 버튼을 클릭할 때 새 창으로 열리기에 그 이후 로직에서 오류가 터지게 된다. 

> **참고**: 안드로이드 웹앱 환경에서만 문제가 발생했다. iOS는 문제가 발생하지 않는다.

### 해결 방안

카카오 네이버 로그인 구현 과정에서 창을 띄우기 위해 총 2가지 방안을 생각했다.

#### 1. 웹앱 창 증가

네이버 및 카카오 로그인에서 어플리케이션 개발자의 도움을 받아 웹앱의 창을 늘리는 방안이다. 

창을 무한대로 늘릴 수도 없고, 다수의 창이 들어갈 경우 웹앱 컨트롤에 난항을 겪을 수 있어 이 방안은 포기했다.

#### 2. 보기 화면 우회

웹앱을 늘릴 수 없으니, 카카오 혹은 네이버 로그인 창 자체를 새로운 창에서 열고, 이 창만 컨트롤 하는 방법을 생각했다. 

API를 호출할 때 그곳에서 새로운 창을 불러 화면에 띄워주니 이 창 자체를 새롭게 열고 컨트롤 하는 방식이다. 앱 개발자의 도움을 받아 웹앱에서 새로운 창을 띄우게 한 후, 기존에 각종 약관들에 연결된 창들을 새롭게 만들어 닫기 버튼을 누를 경우 (어플에서만) 창이 닫히도록 구현했다. 

베스트 방안은 아니라고 생각하지만 어플리케이션 개발 기간을 줄이고, 웹 및 서버 단에서의 개발을 중점으로 개발했기에 어쩔 수 없는 선택이었다.

### 해결 결과

**2번 방안**으로 로그인 관련 로직을 대폭 수정하여 구현에 성공했다.

## 3. CORS 에러

CORS 에러는 **교차 출처 리소스 에러**로 최신 브라우저에서 구현된 동일 출처 정책 에러로 인해 발생하게 된다. 

동일 출처 리소스란 말 그대로 동일한 출처에서 나온 리소스들로부터 서버를 동작하게 하는 부분인데, 프론트 단에서 AJAX로 API를 호출한 후 서버 단에서 작업을 진행하며 해당 오류를 발생시켰다.

### 문제 상황

이 CORS 에러는 악명 높은 에러이니만큼 스프링 단에서 `@CORS` 어노테이션을 제공해주어 이 어노테이션을 사용하거나, 필터를 사용하면 손쉽게 해결이 가능하다. 

하지만 **스프링 4.2에서는 지원이 안된다...**

### 해결 과정

CORS 해결을 위해 여러 필터를 개발해서 적용해보았지만 스프링 4.2 및 자바 7 버전에서는 작동하지 않았다. 여러 방안을 찾아보며 적용시키려 노력했지만 개발 환경단에서 해결하더라도 운영 환경단에서 문제가 터질 수 있으니 로직 자체를 변경하여 서버 단에서 로그인을 진행하도록 코드를 변경하라는 조언을 들었다.

### 해결 방안

결국 필터로 CORS 에러를 해결하는 방식을 포기하고 로직을 변경해 서버 단에서 API를 호출하고, 모든 API 이후 로직을 서버 단에서 진행한 후 프론트로 리턴시켜주는 방안을 생각했다. 

이 로직을 적용하고 난 후 프론트 로그인 창에서 AJAX와 같은 기능으로 로그인 창으로 리다이렉트 시켜줄 수 없으니 어쩔 수 없이 프론트의 다른 temp 페이지를 만들어 호출해 CORS를 우회했다.

**기존 로직:**
```
로그인 창(AJAX) → 서버 → 리턴 데이터 받은 후 동작
```

**변경된 로직:**
```
로그인 창 → 서버 → temp 페이지 → 로그인 후 화면
```

서버 단에서 동작한 작업의 내용이 같은 자바스크립트 코드 단을 타지 않도록 로직 자체를 변경했다.

## 시사점

**JDK는 최소 1.8, 스프링은 최신 버전을 사용하도록 하자. 정말 고생 많이했다.**

