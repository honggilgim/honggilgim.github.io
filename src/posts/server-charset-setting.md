## 1. 개요

현재 재직중인 회사에서 서버에 저장되는 정보를 다른 회사의 에이전트가 데이터를 뽑아가 그 데이터들을 이용해 비즈니스 로직을 수행하는 서비스가 존재한다. 알림톡, sms와 같은 발송을 하는 서비스인데, 이 서비스는 서버끼리의 통신에서의 charset이 정말 중요하다. UTF8, EUC-KR, KO16KSC5601 등의 인코딩 방식이 있는데 보통 서버에서 데이터를 다룰 때 사용하는 방식은 UTF8이다.

이 데이터 인코딩이 서버일 경우에는 간단한 코딩으로 해결이 가능하지만, 문제는 DB일 때는 이 encoding 변경이 매우 고생스럽다.

## 2. MariaDB의 경우

MariaDB는 다행히 encoding에 관련된 여러가지 설정이 가능하다. 테이블 칼럼의 인코딩만 변경할 수도 있고 테이블 전체의 인코딩, 데이터베이스 전체의 인코딩 변경 등 많은 방식이 존재한다. 그렇기에 MariaDB 는 많은 방식을 시도할 수 있다.

물론 데이터가 변경될 수 있으니 데이터 검증은 필수다.

### 2-1. 테이블의 특정 칼럼만 인코딩 변경하여 데이터 저장하기

특정 칼럼의 인코딩 셋을 변경하여 데이터 저장 방식을 변경했다. maria의 api는 데이터를 받아와 DB에 넣어주기만 하는 형식을 취하므로, 테이블의 인코딩 형식을 변경하여 원하는 encoding으로 테이블에 들어가도록 인코딩 설정을 변경했다. 그리고 실패했다. 상대 에이전트가 가져가는 데이터에서는 변경된 인코딩 설정으로 들어온 데이터가 받아지지 않았다.

### 2-2. 테이블의 인코딩 설정 변경하여 데이터 저장하기

테이블 자체의 인코딩 설정을 변경해봤다. 이전보다 영향도가 컸기에 데이터 검증을 정밀히 진행하기로 했고, 이 방식의 테스트는 다음에 일정을 잡고 진행할 예정이다. 이 방식이 안될 경우, 운영하려고 계획했던 프로세스를 아예 다른 방식으로 변경할 예정이다.

## 3. Oracle의 경우

오라클이 정말 골때리는데, 오라클은 공식 문서에서 오라클 데이터베이스의 인코딩 방식은 처음 서버에 설치했을 때 이후로는 교체하지 않는 것을 공식적으로 권장한다. 그리고 오라클은 운영 영향도를 고려해서 특정 테이블의 인코딩 변경, 특정 테이블 특정 칼럼의 인코딩 변경과 같은 방식을 취할수가 없다. 그저 데이터베이스 전체를 변경해야 가능하다.

DB 시스템 뷰인 딕셔너리 뷰를 이용하여 바꾸는 방법이 존재하긴 하는데, 이는 DB 시스템 전체가 깨질 수 있는 매우 위험도가 큰 방법이다.

그래서 여러 방면으로 찾아보다, 오라클은 불가능한 기능으로 결론을 냈다.

서버 혹은 DB를 설치할 때 encoding 설정은 매우 중요하다. 보통 EUC-KR 혹은 KO16KSC5601 같은 인코딩으로 변경하여 사용하곤 하는데 이 옛날 인코딩들은 요즘 DB에서 권장하지 않는 방법이다.

## 4. DB encoding 권장 설정

이번에 작업이 들어간 DB들은 전부 옛날에 설치한 데이터베이스들이기에 어쩔 수 없이 포기했지만, 신규로 설치한다면 꼭 최신 인코딩을 설정하여 설치하는 것이 낫다.

### MariaDB

MariaDB는 **utf8mb4**라는 encoding을 권장하고 최신 시스템일수록 utf8mb4가 아니면 지원해주지 않는 기능이 충분히 있을 수 있다.

### Oracle

오라클은 **AL32UTF8**방식을 사용하여 인코딩하는 것이 제일 좋다.

개인 프로젝트 혹은 데이터가 많이 쌓여있지 않아 운영 영향도가 작은 서비스일 경우에는 걱정 없이 작업을 진행하겠지만, 아쉽게 이번 작업은 운영 영향도가 매우 큰 거대한 데이터를 가진 데이터베이스였다.

infra 단 개발자는 아니지만, 여러 번 이런 경험을 겪을 때마다 좋은 지식을 하나씩 배워간다.

## 5. 결론

**DB 신규 설치 시 Charset을 잘 설정하자.**

